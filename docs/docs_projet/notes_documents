I2C en mode controleur et en mode cible
Bus I2C
Carte en mode pilote et copilote
Réseau en étoile
Si le 2eme puits detecte un probleme il prend le relai
Carte SAM R21 Xplained Pro de Microchip Technology
Microcontrolleur : SAM R21, ARM Cortex-M0+, ATSAMR21G18A de 32 bits à 48 MHz
Memoire flash 256 ko
Memoire statique de 32 ko
Alimentation de 5V ou port USB de l'ordi
IDE Microchip Studio : développer, deboguer et progeammer des applications
RIOT OS ne dispose pas des outils necessaires pour la communication entre 2 cartes
Débogueur intégré à Microchip studio surveiller variables en temps réel, executer pas a pas le code, points d'arret et erreurs de code
Integre ASF Wizard : bibliothèques pretes a l'emploi pour les microcontrolleurs : communications,
interfaces utilisateur, sécurité
LogicPort, simulateur graphique visualiser en temps reel entre deux cartes la communication
D'abord faire clignoter LED sur la carte (mini-projet), blinky project
Recherche sur site du concepteur de la carte en plsu de datasheets
LED au port PA19 doit etre configuré en sortie
port-pin-set-output-level : driver PORT, apprendre utilisation des outils
RIOT OS ne supporte pas de base l'utilisation du I2C en esclave
Voir protocole et séquence du peripherique en mode esclave I2C
Attente active
Pouvoir communicuqer avec SERCOM (SERIAL COMMUNICATION interface), supporte USART, SPI et I2C
mode classique registre DATA recupere donnees emises
mode peripherique DMA pour optimiser processeur
Mode classique choisi
"Manipuler dans l'API les registres internes au pilote parametrant la boucle d'interruption
Partie communication jamais abordée dans cours et TP, recherches, résultats :
I2C communication entre differents composants d'une carte electronique
Echanges de trames predefinies
UART
Bits par seconde : bauds (baud rate)
I2C CHOISI POUR LE PROJET
Il y a des bibioltheques en ASF gerant ce protocole
Habituellement controlleur : processeur, cible : memoire
Configurer le sercom pour etre soit en mode cible soit en mode controleur
Apparemment 1 carte maitre 1 carte esclave
Drivers I2C slave et I2C master
Quand maitre a probleme, l'esclave envoie un message pour lui dire de s'arreter et il prend sa place
D'abord rotation des roles
1 bloc de code maitre et 1 esclave
Ancien code : liste chainee apres phase de decouverte envoyee
Integration CRC, cyclic redundancy check, voir details dans rapport
Esclave demande interruption au maitre
A nouveau divisé en 2, 1 pour carte qui envoie interruption, un pour celle qui recoit
ASF : advanced software framework
Broche pull up et pull down
Moniteur de battement du coeur
"Cette technique consiste à ajouter une fonctionnalité
logicielle sur la carte copilote, qui vérifie que l’autre carte pilote est toujours en vie. Si la
carte électronique pilote ne répond pas, cela signifie qu’elle a peut-être planté ou qu’elle
ne fonctionne pas correctement. Dans ce cas, la carte copilote doit déclencher une action
corrective. Cette action doit être une interruption envoyée à la carte pilote pour qu’elle
puisse lâcher la communication et deviennent copilote (inversement de rôle)"


/!\ Atmel SAM R21 Xplained Pro





